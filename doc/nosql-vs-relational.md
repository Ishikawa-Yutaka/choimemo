# NoSQL とリレーショナルデータベースの違いと用途

このドキュメントでは、NoSQL とリレーショナル（SQL）データベースの違い、それぞれの特徴、以及びどんなアプリに向いているかを学習用にまとめています。

---

## 📋 目次

1. [基本の違い](#基本の違い)
2. [データの形とスキーマ](#データの形とスキーマ)
3. [問い合わせ・トランザクション](#問い合わせトランザクション)
4. [スケールの考え方](#スケールの考え方)
5. [用途の比較](#用途の比較)
6. [このプロジェクト（ちょいMEMO）での選択](#このプロジェクトちょいmemoでの選択)
7. [まとめ表](#まとめ表)

---

## 基本の違い

### リレーショナルデータベース（SQL）

- **表（テーブル）** でデータを管理する
- 行（レコード）と列（カラム）があり、テーブル同士は **外部キー** で関連づける
- **スキーマが固定**：あらかじめカラムを決め、型や制約を定義する
- 問い合わせには **SQL**（Structured Query Language）を使う

**例**: PostgreSQL, MySQL, SQLite

---

### NoSQL データベース

- 「リレーショナル以外」のデータベースの総称
- 種類によってデータの持ち方が異なる：
  - **ドキュメント型**: JSON のような階層構造（Firestore, MongoDB）
  - **キーバリュー型**: キーに対応する値を保存（Redis など）
  - **グラフ型**: ノードと関係でデータを表現
- **スキーマレス**（柔軟）なものが多く、後からフィールドを追加しやすい
- 製品ごとに専用の API やクエリ言語を使う

**例**: Firestore, MongoDB, DynamoDB

---

## データの形とスキーマ

### リレーショナルの場合

```
users テーブル
| id   | email          | created_at |
|------|----------------|------------|
| u001 | a@example.com  | 2026-01-01 |

memos テーブル
| id   | user_id | content   | created_at |
|------|---------|-----------|------------|
| m001 | u001    | メモ本文   | 2026-01-02 |
```

- ユーザーとメモは **別テーブル** で、`user_id` で紐づける
- カラムを追加するには **マイグレーション** が必要

---

### NoSQL（ドキュメント型・Firestore）の場合

```
users / u001 / memos / m001
{
  "content": "メモ本文",
  "imageUrls": [],
  "created_at": タイムスタンプ,
  "updated_at": タイムスタンプ
}
```

- **1 ドキュメント = 1 メモ** のように、アプリの「オブジェクト」をそのまま保存しやすい
- 後から `tags` フィールドを足すなど、**スキーマを柔軟に変更**しやすい

---

## 問い合わせ・トランザクション

### リレーショナルが得意なこと

| 機能 | 説明 |
|------|------|
| **JOIN** | 複数テーブルを条件で結合して、まとめて取得できる |
| **集計** | GROUP BY, SUM, COUNT などで月別売上・件数などを計算しやすい |
| **トランザクション** | 複数テーブルにまたがる処理を「まとめて成功 or まとめて取り消し」にできる（ACID） |

**例（SQL）**:
```sql
SELECT users.name, COUNT(memos.id)
FROM users
LEFT JOIN memos ON users.id = memos.user_id
GROUP BY users.id;
```

---

### NoSQL が得意なこと

| 機能 | 説明 |
|------|------|
| **キー・パスで取得** | 「このユーザーのメモ一覧」のように、パスが決まっている取得が高速で書きやすい |
| **スキーマの柔軟さ** | ドキュメントごとにフィールドの有無や形を変えやすい |
| **リアルタイム** | Firestore などはリスナーで変更を即時購読できる |

**苦手なこと**: 複数コレクションをまたぐ「結合」や、複雑な集計。そういう用途ではリレーショナルや分析用 DB を併用することが多い。

---

## スケールの考え方

| 観点 | リレーショナル | NoSQL |
|------|----------------|--------|
| **縦スケール** | 1 台のマシンを強化する構成が一般的 | 製品による |
| **横スケール** | 設計とツールが必要（シャーディングなど） | 最初から「台数を増やす」設計の製品が多い |
| **用途** | 基幹系・トランザクション重視 | 大量書き込み・分散を前提にしたサービス向け |

---

## 用途の比較

### リレーショナルが向いているアプリ・システム

- **企業の基幹系**（受発注、在庫、会計）
- **集計・レポートが中心**の業務（月別売上、部門別実績）
- **複数テーブルを同時に更新**したい場合（注文＋明細＋在庫の一貫性）
- **BI ツール**（Tableau, Power BI など）とつなぐ分析用データ

→ **「関係性・整合性・集計」が重要なとき** に選ぶとよい。

---

### NoSQL が向いているアプリ

| アプリの種類 | 理由 |
|--------------|------|
| **メモ・ノート・ToDo** | 1 ユーザー = 自分の一覧。結合がほぼ不要で、リアルタイム同期と相性が良い |
| **SNS・タイムライン・チャット** | 投稿単位でドキュメント化しやすく、スキーマの変化にも対応しやすい |
| **ブログ・CMS** | 1 記事 = 1 ドキュメント。タグやカテゴリを配列で持てる |
| **ゲームのセーブ・ユーザー設定** | プレイヤーごとに形が違ってもよく、キーで取得するだけの単純なアクセス |
| **ログ・イベント** | 大量の「追加のみ」。集計は別システムに任せる構成と相性が良い |

→ **「1 つのまとまりを読む・書く」が中心で、結合や複雑な集計が少ないとき** に選ぶとよい。

---

## このプロジェクト（ちょいMEMO）での選択

- **1 ユーザー = 自分のメモ一覧** というシンプルな構造
- **「users/{userId}/memos」で一覧取得** のように、パスがはっきりしている
- 結合はほぼ不要で、**リアルタイムリスナー** とも相性が良い

→ このような **シンプルな CRUD ＋ リアルタイム** には、NoSQL（Firestore）の良さが出やすい。

---

## まとめ表

| 項目 | リレーショナル（SQL） | NoSQL |
|------|------------------------|--------|
| **データの形** | 表（行・列）、テーブル同士を外部キーで関連 | ドキュメント（JSON 風）、キーバリューなど |
| **スキーマ** | 固定。変更はマイグレーション | スキーマレス（柔軟）なものが多い |
| **問い合わせ** | SQL。JOIN・集計が得意 | キー・パスでの取得が得意。結合は苦手 |
| **トランザクション** | 複数テーブル跨ぎの ACID が標準 | 製品による。範囲が限定的なことが多い |
| **向いている用途** | 基幹系、集計、レポート、整合性重視 | メモ・SNS・ログ・設定など、単純な CRUD とリアルタイム |

---

### 選び方の目安

- **「表同士の関係・集計・一貫性」が重要** → リレーショナル
- **「形が変わりやすい・アクセスが単純・横に広げたい」** → NoSQL

「どちらが正解」ではなく、**データの形とアクセスパターンに合わせて選ぶ** とよいです。

---

**作成日**: 2026-02-12  
**プロジェクト**: ちょいMEMO  
**用途**: 学習用メモ
