# Firestore Security Rulesã¨ãƒ­ãƒ¼ãƒ¬ãƒ™ãƒ«ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®é•ã„

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã¯ã€Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ãŠã‘ã‚‹ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®éšå±¤æ§‹é€ ã¨ã€Firestore Security Rulesã®å½¹å‰²ã«ã¤ã„ã¦è§£èª¬ã—ã¾ã™ã€‚

---

## ğŸ“‹ ç›®æ¬¡

1. [ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®éšå±¤æ§‹é€ ](#ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®éšå±¤æ§‹é€ )
2. [ãƒ­ãƒ¼ãƒ¬ãƒ™ãƒ«ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¨ã¯](#ãƒ­ãƒ¼ãƒ¬ãƒ™ãƒ«ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¨ã¯)
3. [Firestore Security Rulesã¨ã¯](#firestore-security-rulesã¨ã¯)
4. [BaaSæ¯”è¼ƒï¼šFirebase vs Supabase](#baasæ¯”è¼ƒfirebase-vs-supabase)
5. [Next.jsã¨ã®æ¯”è¼ƒ](#nextjsã¨ã®æ¯”è¼ƒ)
6. [æ”»æ’ƒã‚·ãƒŠãƒªã‚ªã¨é˜²å¾¡](#æ”»æ’ƒã‚·ãƒŠãƒªã‚ªã¨é˜²å¾¡)
7. [å®Ÿè£…ä¾‹](#å®Ÿè£…ä¾‹)

---

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®éšå±¤æ§‹é€ 

Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¯ã€è¤‡æ•°ã®å±¤ã§æ§‹æˆã•ã‚Œã¦ã„ã¾ã™ã€‚

### 3å±¤ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¢ãƒ‡ãƒ«

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç¬¬1å±¤: ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰èªè¨¼        â”‚  â† ãƒ­ãƒ¼ãƒ¬ãƒ™ãƒ«
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Protected Route                    â”‚
â”‚  - æœªãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’æ’é™¤          â”‚
â”‚  - ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ      â”‚
â”‚  å®Ÿè¡Œå ´æ‰€: ãƒ–ãƒ©ã‚¦ã‚¶                  â”‚
â”‚  çªç ´å¯èƒ½æ€§: âš ï¸ ã‚ã‚Šï¼ˆæ”¹å¤‰å¯èƒ½ï¼‰    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç¬¬2å±¤: ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ­ã‚¸ãƒƒã‚¯      â”‚  â† ãƒŸãƒ‰ãƒ«ãƒ¬ãƒ™ãƒ«
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ­ã‚¸ãƒƒã‚¯                  â”‚
â”‚  - è‡ªåˆ†ã®UIDã§ã®ã¿ãƒ‡ãƒ¼ã‚¿å–å¾—         â”‚
â”‚  - å…¥åŠ›ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³                â”‚
â”‚  å®Ÿè¡Œå ´æ‰€: ãƒ–ãƒ©ã‚¦ã‚¶                  â”‚
â”‚  çªç ´å¯èƒ½æ€§: âš ï¸ ã‚ã‚Šï¼ˆæ”¹å¤‰å¯èƒ½ï¼‰    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç¬¬3å±¤: ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰èªè¨¼ãƒ»èªå¯      â”‚  â† ãƒã‚¤ãƒ¬ãƒ™ãƒ«
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Firestore Security Rules           â”‚
â”‚  - ã‚µãƒ¼ãƒãƒ¼ã§å¼·åˆ¶çš„ã«ãƒã‚§ãƒƒã‚¯        â”‚
â”‚  - ã™ã¹ã¦ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’æ¤œè¨¼          â”‚
â”‚  å®Ÿè¡Œå ´æ‰€: Googleã®ã‚µãƒ¼ãƒãƒ¼          â”‚
â”‚  çªç ´å¯èƒ½æ€§: âœ… ãªã—ï¼ˆçµ¶å¯¾å®‰å…¨ï¼‰     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ãƒ­ãƒ¼ãƒ¬ãƒ™ãƒ«ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¨ã¯

### å®šç¾©

**ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ï¼ˆãƒ–ãƒ©ã‚¦ã‚¶ï¼‰ã§å®Ÿè¡Œã•ã‚Œã‚‹ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–**

### ç‰¹å¾´

#### ãƒ¡ãƒªãƒƒãƒˆ
- âœ… **UXã®å‘ä¸Š** - å³åº§ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
- âœ… **ã‚µãƒ¼ãƒãƒ¼è² è·è»½æ¸›** - ä¸è¦ãªãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’æ¸›ã‚‰ã™
- âœ… **å®Ÿè£…ãŒç°¡å˜** - Reactã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§å®Œçµ

#### ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ
- âŒ **æ”¹å¤‰å¯èƒ½** - ãƒ–ãƒ©ã‚¦ã‚¶ã®é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ã§å¤‰æ›´ã§ãã‚‹
- âŒ **ãƒã‚¤ãƒ‘ã‚¹å¯èƒ½** - JavaScriptã‚’ç„¡åŠ¹åŒ–ã™ã‚Œã°ç„¡è¦–ã§ãã‚‹
- âŒ **ä¿¡é ¼ã§ããªã„** - ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®æœ€å¾Œã®ç ¦ã«ã¯ãªã‚‰ãªã„

### å®Ÿè£…ä¾‹

#### 1. Protected Routeï¼ˆèªè¨¼ãƒã‚§ãƒƒã‚¯ï¼‰

```typescript
// src/components/ProtectedRoute.tsx
const ProtectedRoute: React.FC = ({ children }) => {
  const { user, loading } = useAuth()

  if (loading) {
    return <div>èª­ã¿è¾¼ã¿ä¸­...</div>
  }

  // æœªãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
  if (!user) {
    return <Navigate to="/login" />
  }

  return <>{children}</>
}
```

**å½¹å‰²**: æœªãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ãƒšãƒ¼ã‚¸ã‹ã‚‰æ’é™¤

**å•é¡Œç‚¹**:
```javascript
// æ”»æ’ƒè€…ãŒãƒ–ãƒ©ã‚¦ã‚¶ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§å®Ÿè¡Œ
localStorage.setItem('fakeUser', JSON.stringify({ uid: '123' }))
// â†’ Protected Routeã‚’ãƒã‚¤ãƒ‘ã‚¹ã§ãã¦ã—ã¾ã†å¯èƒ½æ€§
```

#### 2. ãƒ•ã‚©ãƒ¼ãƒ ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³

```typescript
// ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®å½¢å¼ãƒã‚§ãƒƒã‚¯
const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/
if (!emailRegex.test(email)) {
  setError('ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®å½¢å¼ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“')
  return
}
```

**å½¹å‰²**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å…¥åŠ›ãƒŸã‚¹ã‚’é˜²ã

**å•é¡Œç‚¹**:
```javascript
// æ”»æ’ƒè€…ãŒHTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ç›´æ¥é€ä¿¡
fetch('https://api.example.com/signup', {
  method: 'POST',
  body: JSON.stringify({ email: 'ä¸æ­£ãªå½¢å¼' })
})
// â†’ ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Œå…¨ã«ã‚¹ã‚­ãƒƒãƒ—
```

#### 3. ãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ­ã‚¸ãƒƒã‚¯

```typescript
// è‡ªåˆ†ã®UIDã§ãƒ‡ãƒ¼ã‚¿å–å¾—
const { user } = useAuth()
const memos = await getMemos(user.uid)
```

**å½¹å‰²**: é€šå¸¸ã®ä½¿ç”¨ã§èª¤ã£ã¦ä»–äººã®ãƒ‡ãƒ¼ã‚¿ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ãªã„ã‚ˆã†ã«ã™ã‚‹

**å•é¡Œç‚¹**:
```javascript
// æ”»æ’ƒè€…ãŒãƒ–ãƒ©ã‚¦ã‚¶ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§å®Ÿè¡Œ
import { getMemos } from './lib/database'
const otherMemos = await getMemos('ä»–äººã®UID')
// â†’ ã‚³ãƒ¼ãƒ‰ã‚’ç›´æ¥å®Ÿè¡Œã§ãã¦ã—ã¾ã†
```

---

## Firestore Security Rulesã¨ã¯

### å®šç¾©

**Googleã®ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã§å®Ÿè¡Œã•ã‚Œã‚‹ã€å¼·åˆ¶çš„ãªã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ãƒ«ãƒ¼ãƒ«**

### ç‰¹å¾´

#### ãƒ¡ãƒªãƒƒãƒˆ
- âœ… **çµ¶å¯¾å®‰å…¨** - ã‚µãƒ¼ãƒãƒ¼å´ã§å®Ÿè¡Œã•ã‚Œã‚‹ãŸã‚æ”¹å¤‰ä¸å¯èƒ½
- âœ… **ã™ã¹ã¦ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ãƒã‚§ãƒƒã‚¯** - ä¾‹å¤–ãªã—
- âœ… **ãã‚ç´°ã‹ã„åˆ¶å¾¡** - ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ»ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å˜ä½ã§è¨­å®šå¯èƒ½
- âœ… **ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ä¸è¦** - ã‚µãƒ¼ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã‹ãªãã¦è‰¯ã„

#### ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ
- âš ï¸ **å­¦ç¿’ã‚³ã‚¹ãƒˆ** - ç‹¬è‡ªã®æ§‹æ–‡ã‚’è¦šãˆã‚‹å¿…è¦ãŒã‚ã‚‹
- âš ï¸ **ãƒ‡ãƒãƒƒã‚°ãŒé›£ã—ã„** - ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒåˆ†ã‹ã‚Šã«ãã„å ´åˆãŒã‚ã‚‹
- âš ï¸ **ãƒ†ã‚¹ãƒˆãŒå¿…è¦** - Firebaseã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ã§ã®ãƒ†ã‚¹ãƒˆãŒæ¨å¥¨

### å®Ÿè¡Œå ´æ‰€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ãƒ–ãƒ©ã‚¦ã‚¶ï¼ˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼‰            â”‚
â”‚  - ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ“ä½œã§ãã‚‹              â”‚
â”‚  - ã‚³ãƒ¼ãƒ‰ã‚’æ”¹å¤‰ã§ãã‚‹                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â”‚ ã™ã¹ã¦ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Firestore ã‚µãƒ¼ãƒãƒ¼                  â”‚
â”‚  ï¼ˆGoogleã®ã‚µãƒ¼ãƒãƒ¼ï¼‰                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Security Rules ã‚¨ãƒ³ã‚¸ãƒ³ â† ã“ã“ï¼    â”‚
â”‚  â†“                                  â”‚
â”‚  1. èªè¨¼æƒ…å ±ã‚’ãƒã‚§ãƒƒã‚¯               â”‚
â”‚     request.auth.uid ã¯ä½•ï¼Ÿ         â”‚
â”‚  â†“                                  â”‚
â”‚  2. ã‚¢ã‚¯ã‚»ã‚¹å…ˆã‚’ãƒã‚§ãƒƒã‚¯             â”‚
â”‚     ã©ã®ãƒ‘ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹ï¼Ÿ             â”‚
â”‚  â†“                                  â”‚
â”‚  3. ãƒ«ãƒ¼ãƒ«ã«ç…§ã‚‰ã—åˆã‚ã›ã‚‹           â”‚
â”‚     allow read: if ...              â”‚
â”‚  â†“                                  â”‚
â”‚  4. è¨±å¯ or æ‹’å¦                    â”‚
â”‚     âœ… 200 OK                       â”‚
â”‚     âŒ 403 Forbidden                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### åŸºæœ¬æ§‹æ–‡

```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // ãƒ‘ã‚¹ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒãƒ³ã‚°
    match /users/{userId}/memos/{memoId} {
      // æ¡ä»¶å¼ï¼ˆtrue/falseï¼‰
      allow read: if request.auth.uid == userId;
      allow write: if request.auth.uid == userId;
    }
  }
}
```

**æ§‹æ–‡ã®èª¬æ˜**:

| è¦ç´  | èª¬æ˜ | ä¾‹ |
|------|------|-----|
| `match` | ã‚¢ã‚¯ã‚»ã‚¹å…ˆã®ãƒ‘ã‚¹ãƒ‘ã‚¿ãƒ¼ãƒ³ | `/users/{userId}/memos/{memoId}` |
| `{userId}` | ãƒ‘ã‚¹å¤‰æ•°ï¼ˆä»»æ„ã®æ–‡å­—åˆ—ã«ãƒãƒƒãƒï¼‰ | `users/abc123/memos/...` |
| `allow` | è¨±å¯ã™ã‚‹æ“ä½œ | `read`, `write`, `create`, `update`, `delete` |
| `if` | æ¡ä»¶å¼ | `request.auth.uid == userId` |
| `request.auth` | ãƒªã‚¯ã‚¨ã‚¹ãƒˆã—ãŸäººã®èªè¨¼æƒ…å ± | `{ uid: "...", email: "..." }` |

---

## BaaSæ¯”è¼ƒï¼šFirebase vs Supabase

BaaSï¼ˆBackend as a Serviceï¼‰ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¢ãƒ‡ãƒ«ã‚’æ¯”è¼ƒã—ã¾ã™ã€‚

### Firebaseï¼ˆFirestoreï¼‰ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¢ãƒ‡ãƒ«

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ãƒ–ãƒ©ã‚¦ã‚¶ï¼ˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼‰            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚ ç›´æ¥æ¥ç¶š
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Firestore ã‚µãƒ¼ãƒãƒ¼                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Security Rulesï¼ˆç‹¬è‡ªè¨€èªï¼‰          â”‚
â”‚  â†“                                  â”‚
â”‚  match /users/{userId}/memos/{id} { â”‚
â”‚    allow read: if                   â”‚
â”‚      request.auth.uid == userId;    â”‚
â”‚  }                                  â”‚
â”‚  â†“                                  â”‚
â”‚  âœ… or âŒ                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ç‰¹å¾´**:
- âœ… **NoSQLï¼ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå‹ï¼‰**: æŸ”è»Ÿãªãƒ‡ãƒ¼ã‚¿æ§‹é€ 
- âœ… **ç‹¬è‡ªã®Rulesè¨€èª**: JavaScripté¢¨ã®æ§‹æ–‡
- âœ… **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åŒæœŸ**: æ¨™æº–æ©Ÿèƒ½
- âœ… **ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£**: Googleã®ã‚¤ãƒ³ãƒ•ãƒ©
- âš ï¸ **ãƒ™ãƒ³ãƒ€ãƒ¼ãƒ­ãƒƒã‚¯ã‚¤ãƒ³**: Firebaseå°‚ç”¨ã®æ§‹æ–‡

---

### Supabaseï¼ˆPostgreSQLï¼‰ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¢ãƒ‡ãƒ«

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ãƒ–ãƒ©ã‚¦ã‚¶ï¼ˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼‰            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚ ç›´æ¥æ¥ç¶š
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Supabase APIï¼ˆPostgRESTï¼‰          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Row Level Securityï¼ˆRLSï¼‰          â”‚
â”‚  â†“                                  â”‚
â”‚  CREATE POLICY user_memos_policy    â”‚
â”‚  ON memos                           â”‚
â”‚  FOR SELECT                         â”‚
â”‚  USING (auth.uid() = user_id);      â”‚
â”‚  â†“                                  â”‚
â”‚  âœ… or âŒ                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PostgreSQL ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ç‰¹å¾´**:
- âœ… **SQLï¼ˆãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒŠãƒ«ï¼‰**: æ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿ã€JOINãŒå¾—æ„
- âœ… **æ¨™æº–SQL**: PostgreSQLã®Row Level Securityï¼ˆRLSï¼‰
- âœ… **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åŒæœŸ**: Realtimeæ©Ÿèƒ½ã‚ã‚Š
- âœ… **ç§»è¡Œã—ã‚„ã™ã„**: PostgreSQLãªã®ã§ä»–ã®ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã«ç§»è¡Œå¯èƒ½
- âœ… **ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹**: ã‚»ãƒ«ãƒ•ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°å¯èƒ½

---

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ§‹æ–‡ã®æ¯”è¼ƒ

#### Firebase: Security Rules

```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // ãƒ¡ãƒ¢ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³
    match /users/{userId}/memos/{memoId} {
      // èª­ã¿å–ã‚Šï¼šè‡ªåˆ†ã®ãƒ¡ãƒ¢ã®ã¿
      allow read: if request.auth != null
                  && request.auth.uid == userId;

      // ä½œæˆï¼šæ–‡å­—æ•°åˆ¶é™
      allow create: if request.auth != null
                    && request.auth.uid == userId
                    && request.resource.data.content.size() <= 10000;
    }
  }
}
```

**ç‰¹å¾´**:
- ç‹¬è‡ªã®æ§‹æ–‡ï¼ˆJavaScripté¢¨ï¼‰
- ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ‘ã‚¹ã§ãƒãƒƒãƒãƒ³ã‚°
- `request.auth`ã§èªè¨¼æƒ…å ±ã«ã‚¢ã‚¯ã‚»ã‚¹
- ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãƒ¬ãƒ™ãƒ«ã®æ¤œè¨¼ãŒå¯èƒ½

---

#### Supabase: Row Level Security (RLS)

```sql
-- ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ
CREATE TABLE memos (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID REFERENCES auth.users NOT NULL,
  content TEXT CHECK (char_length(content) <= 10000),
  created_at TIMESTAMP DEFAULT NOW()
);

-- RLSã‚’æœ‰åŠ¹åŒ–
ALTER TABLE memos ENABLE ROW LEVEL SECURITY;

-- èª­ã¿å–ã‚Šãƒãƒªã‚·ãƒ¼ï¼šè‡ªåˆ†ã®ãƒ¡ãƒ¢ã®ã¿
CREATE POLICY "Users can read own memos"
ON memos
FOR SELECT
USING (auth.uid() = user_id);

-- ä½œæˆãƒãƒªã‚·ãƒ¼ï¼šè‡ªåˆ†ã®ãƒ¡ãƒ¢ã®ã¿ä½œæˆå¯èƒ½
CREATE POLICY "Users can create own memos"
ON memos
FOR INSERT
WITH CHECK (auth.uid() = user_id);

-- æ›´æ–°ãƒãƒªã‚·ãƒ¼ï¼šè‡ªåˆ†ã®ãƒ¡ãƒ¢ã®ã¿æ›´æ–°å¯èƒ½
CREATE POLICY "Users can update own memos"
ON memos
FOR UPDATE
USING (auth.uid() = user_id)
WITH CHECK (auth.uid() = user_id);

-- å‰Šé™¤ãƒãƒªã‚·ãƒ¼ï¼šè‡ªåˆ†ã®ãƒ¡ãƒ¢ã®ã¿å‰Šé™¤å¯èƒ½
CREATE POLICY "Users can delete own memos"
ON memos
FOR DELETE
USING (auth.uid() = user_id);
```

**ç‰¹å¾´**:
- æ¨™æº–SQLï¼ˆPostgreSQLï¼‰
- ãƒ†ãƒ¼ãƒ–ãƒ«å˜ä½ã§ãƒãƒªã‚·ãƒ¼è¨­å®š
- `auth.uid()`ã§èªè¨¼æƒ…å ±ã«ã‚¢ã‚¯ã‚»ã‚¹
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åˆ¶ç´„ï¼ˆCHECKï¼‰ã‚‚ä½µç”¨å¯èƒ½

---

### ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«ã®é•ã„

#### Firebaseï¼ˆNoSQL / ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå‹ï¼‰

```
Firestoreæ§‹é€ ï¼ˆéšå±¤çš„ï¼‰:

users (ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³)
  â””â”€ {userId} (ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ)
      â””â”€ memos (ã‚µãƒ–ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³)
          â”œâ”€ {memoId1} (ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ)
          â”‚   â”œâ”€ content: "ãƒ¡ãƒ¢ã®å†…å®¹"
          â”‚   â”œâ”€ created_at: Timestamp
          â”‚   â””â”€ updated_at: Timestamp
          â””â”€ {memoId2} (ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ)
              â””â”€ ...
```

**ãƒ¡ãƒªãƒƒãƒˆ**:
- âœ… éšå±¤æ§‹é€ ãŒç›´æ„Ÿçš„
- âœ… ã‚¹ã‚­ãƒ¼ãƒãƒ¬ã‚¹ï¼ˆæŸ”è»Ÿï¼‰
- âœ… ãƒã‚¹ãƒˆã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’1å›ã§å–å¾—

**ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ**:
- âŒ JOINä¸å¯ï¼ˆè¤‡æ•°ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã®çµåˆãŒé›£ã—ã„ï¼‰
- âŒ è¤‡é›‘ãªã‚¯ã‚¨ãƒªãŒè‹¦æ‰‹
- âŒ ãƒ‡ãƒ¼ã‚¿ã®é‡è¤‡ãŒç™ºç”Ÿã—ã‚„ã™ã„

---

#### Supabaseï¼ˆSQL / ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒŠãƒ«ï¼‰

```sql
-- ãƒ†ãƒ¼ãƒ–ãƒ«æ§‹é€ ï¼ˆæ­£è¦åŒ–ï¼‰

-- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆauth.usersã‚’ä½¿ç”¨ï¼‰
-- Supabase AuthãŒè‡ªå‹•ç®¡ç†

-- ãƒ¡ãƒ¢ãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE memos (
  id UUID PRIMARY KEY,
  user_id UUID REFERENCES auth.users(id),
  content TEXT,
  created_at TIMESTAMP,
  updated_at TIMESTAMP
);

-- ã‚¿ã‚°ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆå°†æ¥ã®æ‹¡å¼µï¼‰
CREATE TABLE tags (
  id UUID PRIMARY KEY,
  name TEXT UNIQUE
);

-- ãƒ¡ãƒ¢ã¨ã‚¿ã‚°ã®ä¸­é–“ãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE memo_tags (
  memo_id UUID REFERENCES memos(id),
  tag_id UUID REFERENCES tags(id),
  PRIMARY KEY (memo_id, tag_id)
);
```

**ãƒ¡ãƒªãƒƒãƒˆ**:
- âœ… JOINå¯èƒ½ï¼ˆè¤‡é›‘ãªã‚¯ã‚¨ãƒªãŒå¾—æ„ï¼‰
- âœ… ãƒ‡ãƒ¼ã‚¿ã®æ­£è¦åŒ–ï¼ˆé‡è¤‡ãªã—ï¼‰
- âœ… ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å¯¾å¿œ
- âœ… SQLæ¨™æº–ã®æ©Ÿèƒ½ãŒä½¿ãˆã‚‹

**ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ**:
- âŒ ã‚¹ã‚­ãƒ¼ãƒè¨­è¨ˆãŒå¿…è¦
- âŒ ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç®¡ç†ãŒå¿…è¦
- âŒ NoSQLã‚ˆã‚Šå­¦ç¿’ã‚³ã‚¹ãƒˆãŒé«˜ã„

---

### ã‚³ãƒ¼ãƒ‰ä¾‹ã®æ¯”è¼ƒ

#### Firebaseï¼ˆFirestoreï¼‰ã§ã®ãƒ‡ãƒ¼ã‚¿å–å¾—

```typescript
// src/lib/database.tsï¼ˆFirebaseç‰ˆï¼‰
import { collection, getDocs, query, orderBy } from 'firebase/firestore'
import { db } from './firebase'

export async function getMemos(userId: string) {
  const memosRef = collection(db, `users/${userId}/memos`)
  const q = query(memosRef, orderBy('created_at', 'desc'))
  const snapshot = await getDocs(q)

  return snapshot.docs.map(doc => ({
    id: doc.id,
    ...doc.data()
  }))
}
```

**ç‰¹å¾´**:
- ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ãƒ‘ã‚¹ã§éšå±¤ã‚’è¡¨ç¾
- Firebase SDKå°‚ç”¨ã®é–¢æ•°
- NoSQLã‚‰ã—ã„ã‚·ãƒ³ãƒ—ãƒ«ãªã‚³ãƒ¼ãƒ‰

---

#### Supabaseï¼ˆPostgreSQLï¼‰ã§ã®ãƒ‡ãƒ¼ã‚¿å–å¾—

```typescript
// src/lib/database.tsï¼ˆSupabaseç‰ˆï¼‰
import { createClient } from '@supabase/supabase-js'

const supabase = createClient(
  process.env.SUPABASE_URL,
  process.env.SUPABASE_ANON_KEY
)

export async function getMemos(userId: string) {
  const { data, error } = await supabase
    .from('memos')
    .select('*')
    .eq('user_id', userId)
    .order('created_at', { ascending: false })

  if (error) throw error
  return data
}

// å°†æ¥ã®æ‹¡å¼µä¾‹ï¼šã‚¿ã‚°ä»˜ããƒ¡ãƒ¢ã‚’å–å¾—ï¼ˆJOINã‚’ä½¿ç”¨ï¼‰
export async function getMemosWithTags(userId: string) {
  const { data, error } = await supabase
    .from('memos')
    .select(`
      *,
      memo_tags (
        tags (
          id,
          name
        )
      )
    `)
    .eq('user_id', userId)
    .order('created_at', { ascending: false })

  if (error) throw error
  return data
}
```

**ç‰¹å¾´**:
- SQLãƒ©ã‚¤ã‚¯ãªã‚¯ã‚¨ãƒªãƒ“ãƒ«ãƒ€ãƒ¼
- JOINãŒå¯èƒ½ï¼ˆãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å–å¾—ãŒç°¡å˜ï¼‰
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãŒæ˜ç¤ºçš„

---

### ç§»è¡Œã®ã—ã‚„ã™ã•

#### Firebase â†’ ä»–ã®ã‚µãƒ¼ãƒ“ã‚¹ã¸ã®ç§»è¡Œ

```
âŒ é›£æ˜“åº¦: é«˜

ç†ç”±:
- Security Rulesï¼ˆç‹¬è‡ªæ§‹æ–‡ï¼‰ã‚’æ›¸ãç›´ã™å¿…è¦ãŒã‚ã‚‹
- Firestoreã®éšå±¤æ§‹é€ ã‚’SQLãƒ†ãƒ¼ãƒ–ãƒ«ã«å¤‰æ›
- Firebase SDKä¾å­˜ã®ã‚³ãƒ¼ãƒ‰ã‚’ã™ã¹ã¦æ›¸ãæ›ãˆ
- ãƒ‡ãƒ¼ã‚¿ã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆãƒ»ã‚¤ãƒ³ãƒãƒ¼ãƒˆãŒå¿…è¦

ã‚³ã‚¹ãƒˆ: ğŸ”´ğŸ”´ğŸ”´ğŸ”´ğŸ”´ï¼ˆéå¸¸ã«é«˜ã„ï¼‰
```

---

#### Supabase â†’ ä»–ã®PostgreSQLå¯¾å¿œã‚µãƒ¼ãƒ“ã‚¹ã¸ã®ç§»è¡Œ

```
âœ… é›£æ˜“åº¦: ä½

ç†ç”±:
- PostgreSQLæ¨™æº–ã®RLSã‚’ãã®ã¾ã¾ä½¿ãˆã‚‹
- SQLãƒ€ãƒ³ãƒ—ã§ç°¡å˜ã«ãƒ‡ãƒ¼ã‚¿ç§»è¡Œ
- æ¨™æº–SQLãªã®ã§ä»–ã®ã‚µãƒ¼ãƒ“ã‚¹ã§ã‚‚ã»ã¼åŒã˜
- å¿…è¦ã«å¿œã˜ã¦ã‚»ãƒ«ãƒ•ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°å¯èƒ½

ç§»è¡Œå…ˆã®ä¾‹:
- AWS RDSï¼ˆPostgreSQLï¼‰
- Google Cloud SQLï¼ˆPostgreSQLï¼‰
- Heroku Postgres
- è‡ªå‰ã®PostgreSQLã‚µãƒ¼ãƒãƒ¼

ã‚³ã‚¹ãƒˆ: ğŸŸ¢ğŸŸ¢ï¼ˆä½ã„ï¼‰
```

---

### æ¯”è¼ƒè¡¨

| é …ç›® | Firebaseï¼ˆFirestoreï¼‰ | Supabaseï¼ˆPostgreSQLï¼‰ |
|------|----------------------|----------------------|
| **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹** | NoSQLï¼ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå‹ï¼‰ | SQLï¼ˆãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒŠãƒ«ï¼‰ |
| **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£** | Security Rules | Row Level Security (RLS) |
| **æ§‹æ–‡** | ç‹¬è‡ªï¼ˆJavaScripté¢¨ï¼‰ | æ¨™æº–SQL |
| **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ** | âœ… æ¨™æº– | âœ… ã‚ã‚Š |
| **JOIN** | âŒ ä¸å¯ | âœ… å¯èƒ½ |
| **ã‚¹ã‚­ãƒ¼ãƒ** | ä¸è¦ï¼ˆæŸ”è»Ÿï¼‰ | å¿…è¦ï¼ˆå³æ ¼ï¼‰ |
| **ç§»è¡Œæ€§** | âŒ ä½ï¼ˆãƒ™ãƒ³ãƒ€ãƒ¼ãƒ­ãƒƒã‚¯ï¼‰ | âœ… é«˜ï¼ˆæ¨™æº–SQLï¼‰ |
| **å­¦ç¿’ã‚³ã‚¹ãƒˆ** | NoSQL + Rulesæ§‹æ–‡ | SQL + RLS |
| **ã‚³ã‚¹ãƒˆ** | å¾“é‡èª²é‡‘ï¼ˆRead/Writeæ•°ï¼‰ | å¾“é‡èª²é‡‘ï¼ˆãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚µã‚¤ã‚ºï¼‰ |
| **ç„¡æ–™æ ** | 50k reads/day, 20k writes/day | 500MB DB, 2GB storage |
| **ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹** | âŒ ã„ã„ãˆ | âœ… ã¯ã„ |
| **ã‚»ãƒ«ãƒ•ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°** | âŒ ä¸å¯ | âœ… å¯èƒ½ |

---

### ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§Firebaseã‚’é¸ã‚“ã ç†ç”±

#### âœ… FirebaseãŒé©ã—ã¦ã„ã‚‹ç†ç”±

1. **ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ‡ãƒ¼ã‚¿æ§‹é€ **
   - ãƒ¡ãƒ¢ã‚¢ãƒ—ãƒªã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ â†’ ãƒ¡ãƒ¢ã®å˜ç´”ãªéšå±¤
   - JOINãŒä¸è¦

2. **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åŒæœŸ**
   - Firestoreã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ©Ÿèƒ½ãŒæ¨™æº–
   - è¨­å®šãŒç°¡å˜

3. **ç„¡æ–™æ ãŒååˆ†**
   - å€‹äººãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®è¦æ¨¡ãªã‚‰ç„¡æ–™æ å†…ã§åã¾ã‚‹

4. **å­¦ç¿’ç›®çš„**
   - NoSQLã¨SQLã®ä¸¡æ–¹ã‚’å­¦ã¶ä¾¡å€¤ãŒã‚ã‚‹
   - Security Rulesã®æ¦‚å¿µã‚’ç†è§£ã§ãã‚‹

#### ğŸ”„ å°†æ¥Supabaseã«ç§»è¡Œã™ã‚‹å ´åˆ

CLAUDE.mdã«è¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹é€šã‚Šã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æŠ½è±¡åŒ–ãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼ˆ`src/lib/database.ts`ï¼‰ã‚’å®Ÿè£…ã—ã¦ã„ã‚‹ãŸã‚ã€ç§»è¡Œã‚³ã‚¹ãƒˆã¯æœ€å°é™ã§ã™ï¼š

```typescript
// ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æŠ½è±¡åŒ–ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ãŠã‹ã’ã§ã€
// ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã ã‘æ›¸ãæ›ãˆã‚Œã°è‰¯ã„

// ç¾åœ¨ï¼ˆFirebaseç‰ˆï¼‰
export async function getMemos(userId: string) {
  // Firestoreå®Ÿè£…
}

// ç§»è¡Œå¾Œï¼ˆSupabaseç‰ˆï¼‰
export async function getMemos(userId: string) {
  // Supabaseå®Ÿè£…
}

// ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå´ã®ã‚³ãƒ¼ãƒ‰ã¯å¤‰æ›´ä¸è¦ï¼
```

**ç§»è¡Œã®åˆ¤æ–­åŸºæº–**ï¼ˆPhase 4ï¼‰:
- ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°ãŒ10,000äººã‚’è¶…ãˆãŸå ´åˆ
- Firebaseã®ã‚³ã‚¹ãƒˆãŒæœˆé¡$50ã‚’è¶…ãˆãŸå ´åˆ
- è¤‡é›‘ãªã‚¯ã‚¨ãƒªï¼ˆJOINï¼‰ãŒå¿…è¦ã«ãªã£ãŸå ´åˆ

---

### ã¾ã¨ã‚ï¼šFirebase vs Supabase

#### Firebaseï¼ˆFirestoreï¼‰ã‚’é¸ã¶ã¹ãå ´åˆ

- âœ… NoSQLã®æŸ”è»Ÿæ€§ãŒæ¬²ã—ã„
- âœ… ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ©Ÿèƒ½ãŒé‡è¦
- âœ… ã‚·ãƒ³ãƒ—ãƒ«ãªéšå±¤æ§‹é€ ã®ãƒ‡ãƒ¼ã‚¿
- âœ… Googleã®ã‚¤ãƒ³ãƒ•ãƒ©ã‚’ä¿¡é ¼ã—ã¦ã„ã‚‹
- âœ… ã™ãã«å§‹ã‚ãŸã„ï¼ˆå­¦ç¿’ã‚³ã‚¹ãƒˆä½ï¼‰

#### Supabaseï¼ˆPostgreSQLï¼‰ã‚’é¸ã¶ã¹ãå ´åˆ

- âœ… SQLã®å¼·åŠ›ã•ãŒæ¬²ã—ã„
- âœ… JOINãŒå¿…è¦ãªè¤‡é›‘ãªã‚¯ã‚¨ãƒª
- âœ… ãƒ™ãƒ³ãƒ€ãƒ¼ãƒ­ãƒƒã‚¯ã‚¤ãƒ³ã‚’é¿ã‘ãŸã„
- âœ… ç§»è¡Œæ€§ã‚’é‡è¦–
- âœ… ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã‚’å¥½ã‚€
- âœ… ã‚»ãƒ«ãƒ•ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã®å¯èƒ½æ€§

**ã©ã¡ã‚‰ã‚‚å®‰å…¨æ€§ã¯åŒç­‰**:
- Firebase Security Rules = ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã§å¼·åˆ¶
- Supabase RLS = ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã§å¼·åˆ¶
- **ä¸¡æ–¹ã¨ã‚‚çµ¶å¯¾ã«å®‰å…¨** âœ…

---

## Next.jsã¨ã®æ¯”è¼ƒ

### Next.jsï¼ˆAPI Routesï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ãƒ–ãƒ©ã‚¦ã‚¶                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚ HTTP ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Next.js ã‚µãƒ¼ãƒãƒ¼ï¼ˆè‡ªåˆ†ã®ã‚µãƒ¼ãƒãƒ¼ï¼‰  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  API Routes                         â”‚
â”‚  â†“                                  â”‚
â”‚  export default async function(req) {â”‚
â”‚    // èªè¨¼ãƒã‚§ãƒƒã‚¯                   â”‚
â”‚    const session = await getSession()â”‚
â”‚    if (!session) {                  â”‚
â”‚      return res.status(401).json({}) â”‚
â”‚    }                                â”‚
â”‚                                     â”‚
â”‚    // ãƒ‡ãƒ¼ã‚¿å–å¾—                     â”‚
â”‚    const memos = await db.query(    â”‚
â”‚      'SELECT * FROM memos WHERE ... 'â”‚
â”‚    )                                â”‚
â”‚    return res.json(memos)           â”‚
â”‚  }                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼ˆPostgreSQLã€MySQLãªã©ï¼‰â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ç‰¹å¾´**:
- âœ… ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã§å®Ÿè¡Œï¼ˆå®‰å…¨ï¼‰
- âœ… æŸ”è»Ÿãªãƒ­ã‚¸ãƒƒã‚¯ã‚’æ›¸ã‘ã‚‹
- âŒ ã‚µãƒ¼ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ã‚’è‡ªåˆ†ã§æ›¸ãå¿…è¦ãŒã‚ã‚‹
- âŒ ã‚µãƒ¼ãƒãƒ¼ã®é‹ç”¨ãƒ»ç®¡ç†ãŒå¿…è¦

### React + Firebaseï¼ˆSecurity Rulesï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ãƒ–ãƒ©ã‚¦ã‚¶                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚ ç›´æ¥æ¥ç¶š
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Firestore ã‚µãƒ¼ãƒãƒ¼                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Security Rules                     â”‚
â”‚  â†“                                  â”‚
â”‚  match /users/{userId}/memos/{id} { â”‚
â”‚    allow read: if                   â”‚
â”‚      request.auth.uid == userId;    â”‚
â”‚  }                                  â”‚
â”‚  â†“                                  â”‚
â”‚  âœ… or âŒ                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ç‰¹å¾´**:
- âœ… ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã§å®Ÿè¡Œï¼ˆå®‰å…¨ï¼‰
- âœ… ã‚µãƒ¼ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ä¸è¦
- âœ… ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åŒæœŸãŒç°¡å˜
- âš ï¸ è¤‡é›‘ãªãƒ­ã‚¸ãƒƒã‚¯ã¯æ›¸ãã«ãã„

### æ¯”è¼ƒè¡¨

| é …ç›® | Next.js API Routes | Firestore Security Rules |
|------|-------------------|-------------------------|
| **å®Ÿè¡Œå ´æ‰€** | è‡ªåˆ†ã®ã‚µãƒ¼ãƒãƒ¼ï¼ˆNode.jsï¼‰ | Googleã®ã‚µãƒ¼ãƒãƒ¼ |
| **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¬ãƒ™ãƒ«** | ğŸŸ¢ é«˜ï¼ˆã‚µãƒ¼ãƒãƒ¼å´ï¼‰ | ğŸŸ¢ é«˜ï¼ˆã‚µãƒ¼ãƒãƒ¼å´ï¼‰ |
| **ã‚µãƒ¼ãƒãƒ¼é‹ç”¨** | âŒ å¿…è¦ | âœ… ä¸è¦ |
| **ã‚³ãƒ¼ãƒ‰é‡** | å¤šã„ï¼ˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚³ãƒ¼ãƒ‰ï¼‰ | å°‘ãªã„ï¼ˆRulesã®ã¿ï¼‰ |
| **æŸ”è»Ÿæ€§** | ğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸ | ğŸŒŸğŸŒŸ |
| **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ** | ãƒãƒ¼ãƒªãƒ³ã‚°ãŒå¿…è¦ | âœ… æ¨™æº–å¯¾å¿œ |
| **å­¦ç¿’ã‚³ã‚¹ãƒˆ** | Node.js + DBçŸ¥è­˜ | Rulesã®æ§‹æ–‡ |
| **ã‚³ã‚¹ãƒˆ** | ã‚µãƒ¼ãƒãƒ¼è²»ç”¨ | å¾“é‡èª²é‡‘ï¼ˆç„¡æ–™æ ã‚ã‚Šï¼‰ |

---

## æ”»æ’ƒã‚·ãƒŠãƒªã‚ªã¨é˜²å¾¡

### ã‚·ãƒŠãƒªã‚ª1: é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ã§ã‚³ãƒ¼ãƒ‰æ”¹å¤‰

#### æ”»æ’ƒæ‰‹æ³•

```javascript
// ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§å®Ÿè¡Œ
// Protected Routeã‚’ãƒã‚¤ãƒ‘ã‚¹ã—ã‚ˆã†ã¨ã™ã‚‹è©¦ã¿

// æ–¹æ³•1: èªè¨¼çŠ¶æ…‹ã‚’å½è£…
window.fakeAuth = { uid: 'fake-user-id', email: 'fake@example.com' }

// æ–¹æ³•2: ç›´æ¥ãƒ‡ãƒ¼ã‚¿å–å¾—é–¢æ•°ã‚’å®Ÿè¡Œ
import { getDocs, collection } from 'firebase/firestore'
const snapshot = await getDocs(collection(db, 'users/ä»–äººã®UID/memos'))
```

#### ãƒ­ãƒ¼ãƒ¬ãƒ™ãƒ«ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®çµæœ

```
âŒ Protected Route: ãƒã‚¤ãƒ‘ã‚¹ã•ã‚Œã‚‹å¯èƒ½æ€§ã‚ã‚Š
âŒ ã‚¢ãƒ—ãƒªãƒ­ã‚¸ãƒƒã‚¯: ã‚³ãƒ¼ãƒ‰ã‚’ç›´æ¥å®Ÿè¡Œã§ãã‚‹
â†’ ä»–äººã®ãƒ‡ãƒ¼ã‚¿ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¦ã—ã¾ã†
```

#### Security Rulesã«ã‚ˆã‚‹é˜²å¾¡

```javascript
// firestore.rules
match /users/{userId}/memos/{memoId} {
  allow read: if request.auth.uid == userId;
}
```

**çµæœ**:
```
âœ… Firestoreã‚µãƒ¼ãƒãƒ¼ãŒãƒã‚§ãƒƒã‚¯
request.auth.uid = "æ”»æ’ƒè€…ã®UID"
userId = "ä»–äººã®UID"
â†’ ä¸ä¸€è‡´
â†’ 403 Forbidden
```

---

### ã‚·ãƒŠãƒªã‚ª2: HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ç›´æ¥é€ä¿¡

#### æ”»æ’ƒæ‰‹æ³•

```javascript
// curlã‚³ãƒãƒ³ãƒ‰ã‚„Postmanã§ç›´æ¥APIã‚’å©ã
curl -X GET \
  'https://firestore.googleapis.com/v1/projects/choimemo/databases/(default)/documents/users/è¢«å®³è€…ã®UID/memos' \
  -H 'Authorization: Bearer æ”»æ’ƒè€…ã®èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³'
```

#### ãƒ­ãƒ¼ãƒ¬ãƒ™ãƒ«ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®çµæœ

```
âŒ å®Œå…¨ã«ãƒã‚¤ãƒ‘ã‚¹
â†’ ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã®ã‚³ãƒ¼ãƒ‰ã¯å®Ÿè¡Œã•ã‚Œãªã„
â†’ Protected Routeã‚‚ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚‚ã‚¹ã‚­ãƒƒãƒ—
```

#### Security Rulesã«ã‚ˆã‚‹é˜²å¾¡

```javascript
// Firestoreã‚µãƒ¼ãƒãƒ¼ãŒèªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ã‚’æ¤œè¨¼
Authorization: Bearer æ”»æ’ƒè€…ã®ãƒˆãƒ¼ã‚¯ãƒ³
â†“
ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ãƒ‡ã‚³ãƒ¼ãƒ‰
â†“
request.auth.uid = "æ”»æ’ƒè€…ã®UID"
â†“
ãƒ‘ã‚¹: /users/è¢«å®³è€…ã®UID/memos
â†“
Security Rules: request.auth.uid != "è¢«å®³è€…ã®UID"
â†“
403 Forbidden
```

---

### ã‚·ãƒŠãƒªã‚ª3: æ‚ªæ„ã®ã‚ã‚‹JavaScriptã‚’å®Ÿè¡Œ

#### æ”»æ’ƒæ‰‹æ³•

```javascript
// ãƒ–ãƒ©ã‚¦ã‚¶æ‹¡å¼µæ©Ÿèƒ½ã‚„æ”¹å¤‰ç‰ˆã‚¢ãƒ—ãƒªã‚’ä½œæˆ
// ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æŠ½è±¡åŒ–ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ç›´æ¥å®Ÿè¡Œ

import { getMemos } from './lib/database'

// å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®UIDã‚’ãƒ«ãƒ¼ãƒ—
const uids = ['uid1', 'uid2', 'uid3', ...]
for (const uid of uids) {
  const memos = await getMemos(uid)
  console.log(`${uid}ã®ãƒ¡ãƒ¢ã‚’å–å¾—:`, memos)
}
```

#### ãƒ­ãƒ¼ãƒ¬ãƒ™ãƒ«ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®çµæœ

```
âŒ é–¢æ•°ãŒå®Ÿè¡Œã•ã‚Œã¦ã—ã¾ã†
âŒ ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ™ãƒ«ã§ã¯é˜²ã’ãªã„
```

#### Security Rulesã«ã‚ˆã‚‹é˜²å¾¡

```javascript
// å„ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒFirestoreã‚µãƒ¼ãƒãƒ¼ã«å±Šã

ãƒªã‚¯ã‚¨ã‚¹ãƒˆ1: users/uid1/memos
â†’ request.auth.uid != "uid1"
â†’ 403 Forbidden

ãƒªã‚¯ã‚¨ã‚¹ãƒˆ2: users/uid2/memos
â†’ request.auth.uid != "uid2"
â†’ 403 Forbidden

...ã™ã¹ã¦æ‹’å¦
```

---

## å®Ÿè£…ä¾‹

### ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆï¼ˆã¡ã‚‡ã„MEMOï¼‰ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å®Ÿè£…

#### ç¬¬1å±¤: Protected Route

```typescript
// src/components/ProtectedRoute.tsx
const ProtectedRoute: React.FC<ProtectedRouteProps> = ({ children }) => {
  const { user, loading } = useAuth()

  if (loading) return <div>èª­ã¿è¾¼ã¿ä¸­...</div>
  if (!user) return <Navigate to="/login" />

  return <>{children}</>
}
```

**å½¹å‰²**: UXã®å‘ä¸Šï¼ˆæœªãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«æ—©æœŸãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ï¼‰

**ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¬ãƒ™ãƒ«**: âš ï¸ ä½ï¼ˆãƒ–ãƒ©ã‚¦ã‚¶ã§å®Ÿè¡Œï¼‰

---

#### ç¬¬2å±¤: ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ­ã‚¸ãƒƒã‚¯

```typescript
// src/pages/MemoPage.tsxï¼ˆå°†æ¥å®Ÿè£…äºˆå®šï¼‰
const MemoPage: React.FC = () => {
  const { user } = useAuth()
  const [memos, setMemos] = useState([])

  useEffect(() => {
    if (user) {
      // è‡ªåˆ†ã®UIDã§ã®ã¿ãƒ‡ãƒ¼ã‚¿å–å¾—
      getMemos(user.uid).then(setMemos)
    }
  }, [user])

  return <div>{/* ãƒ¡ãƒ¢ä¸€è¦§è¡¨ç¤º */}</div>
}
```

**å½¹å‰²**: æ­£å¸¸ãªå‹•ä½œã®ä¿è¨¼

**ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¬ãƒ™ãƒ«**: âš ï¸ ä½ã€œä¸­ï¼ˆãƒ–ãƒ©ã‚¦ã‚¶ã§å®Ÿè¡Œï¼‰

---

#### ç¬¬3å±¤: Firestore Security Rules

```javascript
// firestore.rulesï¼ˆã‚¿ã‚¹ã‚¯9ã§å®Ÿè£…äºˆå®šï¼‰
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // ãƒ¡ãƒ¢ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³
    match /users/{userId}/memos/{memoId} {
      // èªè¨¼å¿…é ˆãƒã‚§ãƒƒã‚¯
      allow read: if request.auth != null
                  && request.auth.uid == userId;

      // ä½œæˆ: æ–‡å­—æ•°åˆ¶é™ä»˜ã
      allow create: if request.auth != null
                    && request.auth.uid == userId
                    && request.resource.data.content.size() <= 10000;

      // æ›´æ–°: æ–‡å­—æ•°åˆ¶é™ä»˜ã
      allow update: if request.auth != null
                    && request.auth.uid == userId
                    && request.resource.data.content.size() <= 10000;

      // å‰Šé™¤
      allow delete: if request.auth != null
                    && request.auth.uid == userId;
    }
  }
}
```

**å½¹å‰²**: çµ¶å¯¾çš„ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¿è¨¼

**ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¬ãƒ™ãƒ«**: âœ… æœ€é«˜ï¼ˆã‚µãƒ¼ãƒãƒ¼å´ã§å®Ÿè¡Œï¼‰

---

### Security Rulesã®è©³ç´°èª¬æ˜

#### ä½¿ç”¨ã§ãã‚‹å¤‰æ•°

| å¤‰æ•° | èª¬æ˜ | ä¾‹ |
|------|------|-----|
| `request.auth` | ãƒªã‚¯ã‚¨ã‚¹ãƒˆè€…ã®èªè¨¼æƒ…å ± | `{ uid: "...", email: "..." }` |
| `request.auth.uid` | ãƒ¦ãƒ¼ã‚¶ãƒ¼ID | `"xJ4KmPq3rY..."` |
| `request.auth.token` | ã‚«ã‚¹ã‚¿ãƒ ã‚¯ãƒ¬ãƒ¼ãƒ  | `{ admin: true }` |
| `request.resource.data` | æ›¸ãè¾¼ã‚‚ã†ã¨ã—ã¦ã„ã‚‹ãƒ‡ãƒ¼ã‚¿ | `{ content: "..." }` |
| `resource.data` | æ—¢å­˜ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ‡ãƒ¼ã‚¿ | `{ content: "..." }` |
| `{userId}` | ãƒ‘ã‚¹ã‹ã‚‰æŠ½å‡ºã—ãŸå¤‰æ•° | `"xJ4KmPq3rY..."` |

#### ä½¿ç”¨ã§ãã‚‹é–¢æ•°

```javascript
// æ–‡å­—åˆ—ã®é•·ã•ãƒã‚§ãƒƒã‚¯
request.resource.data.content.size() <= 10000

// ãƒ‡ãƒ¼ã‚¿å‹ãƒã‚§ãƒƒã‚¯
request.resource.data.content is string

// é…åˆ—ã®é•·ã•ãƒã‚§ãƒƒã‚¯
request.resource.data.imageUrls.size() <= 5

// ç¾åœ¨æ™‚åˆ»
request.time < timestamp.date(2027, 1, 1)

// æ­£è¦è¡¨ç¾ãƒãƒƒãƒ
request.resource.data.email.matches('.*@example.com')
```

#### æ“ä½œã®ç¨®é¡

| æ“ä½œ | èª¬æ˜ | ä½¿ç”¨å ´é¢ |
|------|------|----------|
| `read` | `get` + `list` | ãƒ‡ãƒ¼ã‚¿èª­ã¿å–ã‚Šå…¨èˆ¬ |
| `write` | `create` + `update` + `delete` | ãƒ‡ãƒ¼ã‚¿æ›¸ãè¾¼ã¿å…¨èˆ¬ |
| `get` | å˜ä¸€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå–å¾— | `getDoc()` |
| `list` | è¤‡æ•°ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå–å¾— | `getDocs()` |
| `create` | æ–°è¦ä½œæˆ | `addDoc()` |
| `update` | æ›´æ–° | `updateDoc()` |
| `delete` | å‰Šé™¤ | `deleteDoc()` |

---

## ã¾ã¨ã‚

### ãƒ­ãƒ¼ãƒ¬ãƒ™ãƒ«ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

**å®šç¾©**: ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ï¼ˆãƒ–ãƒ©ã‚¦ã‚¶ï¼‰ã§å®Ÿè¡Œã•ã‚Œã‚‹ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

**å½¹å‰²**:
- UXã®å‘ä¸Š
- ä¸è¦ãªãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å‰Šæ¸›
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¸ã®æ—©æœŸãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯

**é™ç•Œ**:
- æ”¹å¤‰å¯èƒ½
- ãƒã‚¤ãƒ‘ã‚¹å¯èƒ½
- ä¿¡é ¼ã§ããªã„

**å®Ÿè£…ä¾‹**:
- Protected Route
- ãƒ•ã‚©ãƒ¼ãƒ ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
- ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã®ãƒ­ã‚¸ãƒƒã‚¯

---

### Firestore Security Rulesï¼ˆãƒã‚¤ãƒ¬ãƒ™ãƒ«ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ï¼‰

**å®šç¾©**: ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ï¼ˆGoogleã®ã‚µãƒ¼ãƒãƒ¼ï¼‰ã§å®Ÿè¡Œã•ã‚Œã‚‹å¼·åˆ¶çš„ãªã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡

**å½¹å‰²**:
- çµ¶å¯¾çš„ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¿è¨¼
- ã™ã¹ã¦ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®æ¤œè¨¼
- ä¸æ­£ã‚¢ã‚¯ã‚»ã‚¹ã®å®Œå…¨ãªé˜²æ­¢

**å¼·ã¿**:
- æ”¹å¤‰ä¸å¯èƒ½
- ãƒã‚¤ãƒ‘ã‚¹ä¸å¯èƒ½
- 100%ä¿¡é ¼ã§ãã‚‹

**å®Ÿè£…ä¾‹**:
- Firestore Security Rules

---

### æ­£ã—ã„ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æˆ¦ç•¥

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ï¼ˆãƒ­ãƒ¼ãƒ¬ãƒ™ãƒ«ï¼‰      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å½¹å‰²: UXå‘ä¸Šã€æ—©æœŸãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯     â”‚
â”‚ ä¿¡é ¼åº¦: âš ï¸ ä½ï¼ˆè£œåŠ©çš„ï¼‰             â”‚
â”‚                                     â”‚
â”‚ å®Ÿè£…:                                â”‚
â”‚ - Protected Route                   â”‚
â”‚ - ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³                     â”‚
â”‚ - æ­£ã—ã„ãƒ­ã‚¸ãƒƒã‚¯                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â†“ è£œå®Œé–¢ä¿‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ï¼ˆãƒã‚¤ãƒ¬ãƒ™ãƒ«ï¼‰          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å½¹å‰²: çµ¶å¯¾çš„ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¿è¨¼        â”‚
â”‚ ä¿¡é ¼åº¦: âœ… æœ€é«˜ï¼ˆå¿…é ˆï¼‰              â”‚
â”‚                                     â”‚
â”‚ å®Ÿè£…:                                â”‚
â”‚ - Firestore Security Rules          â”‚
â”‚   ã¾ãŸã¯                             â”‚
â”‚ - Next.js API Routes                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**é‡è¦ãªåŸå‰‡**:
1. âœ… ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¯ã€Œè£œåŠ©ã€
2. âœ… ã‚µãƒ¼ãƒãƒ¼å´ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãŒã€Œæœ¬å‘½ã€
3. âœ… ä¸¡æ–¹ã‚’å®Ÿè£…ã™ã‚‹ã“ã¨ã§æœ€é«˜ã®UXã¨å®‰å…¨æ€§ã‚’å®Ÿç¾
4. âŒ ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã ã‘ã§ã¯çµ¶å¯¾ã«ä¸ååˆ†

---

## å‚è€ƒãƒªãƒ³ã‚¯

- [Firestore Security Rules å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://firebase.google.com/docs/firestore/security/get-started)
- [Security Rules ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹](https://firebase.google.com/docs/firestore/security/rules-structure)
- [Next.js Authentication](https://nextjs.org/docs/authentication)

---

**ä½œæˆæ—¥**: 2026-02-12
**ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ**: ã¡ã‚‡ã„MEMO
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.0
